(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{235:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return b})),n.d(t,"metadata",(function(){return m})),n.d(t,"rightToc",(function(){return h})),n.d(t,"default",(function(){return g}));var a=n(2),i=n(6),o=(n(0),n(312)),s=n(317),r=n(368),l=n(360),c=n(361),d=n(362),u=n(471),p=n(370),b={id:"user-login",title:"User Login"},m={unversionedId:"self-service/flows/user-login",id:"self-service/flows/user-login",isDocsHomePage:!1,title:"User Login",description:"Please read the Self-Service Flows overview before",source:"@site/docs/self-service/flows/user-login.mdx",permalink:"/kratos/docs/next/self-service/flows/user-login",editUrl:"https://github.com/ory/kratos/edit/master/docs/docs/self-service/flows/user-login.mdx",version:"next",lastUpdatedBy:"aeneasr",lastUpdatedAt:1599636633,sidebar:"docs",previous:{title:"User Registration",permalink:"/kratos/docs/next/self-service/flows/user-registration"},next:{title:"User Settings and Profile Updates",permalink:"/kratos/docs/next/self-service/flows/user-settings"}},h=[{value:"Initialize Login Flow",id:"initialize-login-flow",children:[{value:"Login for Browser Clients",id:"login-for-browser-clients",children:[]},{value:"Login for API Clients",id:"login-for-api-clients",children:[]}]},{value:"Login Flow Payloads",id:"login-flow-payloads",children:[{value:"Login with Username/Email and Password",id:"login-with-usernameemail-and-password",children:[]},{value:"Login with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0",id:"login-with-google-facebook-github--openid-connect--oauth-20",children:[]}]},{value:"Login Flow Form Rendering",id:"login-flow-form-rendering",children:[]},{value:"Login Form Validation",id:"login-form-validation",children:[{value:"Login with Username/Email and Password",id:"login-with-usernameemail-and-password-1",children:[]},{value:"Login with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0",id:"login-with-google-facebook-github--openid-connect--oauth-20-1",children:[]}]},{value:"Successful Login",id:"successful-login",children:[{value:"Browser Clients",id:"browser-clients",children:[]},{value:"API Clients",id:"api-clients",children:[]}]},{value:"Refreshing a Session",id:"refreshing-a-session",children:[]},{value:"Hooks",id:"hooks",children:[]}],f={rightToc:h};function g(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},f,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"rmation")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please read the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../../self-service"}),"Self-Service Flows")," overview before\ncontinuing with this document."))),Object(o.b)("p",null,"There are two Login Flow types supported in ORY Kratos:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Flows where the user sits in front of the Browser (e.g. website, single page\napp, ...)"),Object(o.b)("li",{parentName:"ul"},"Flows where API interaction is required (e.g. mobile app, Smart TV, ...)")),Object(o.b)("p",null,"The Login Flow can be summarized as the following state machine:"),Object(o.b)(s.a,{chart:'\nstateDiagram\n  s1: Flow is initialized\n  s2: Execute Before Login Hook(s)\n  s3: User Interface renders Login Flow Forms\n  s4: Execute After Login Hook(s)\n  s5: Update Login Flow with Error Context(s)\n  s6: Login successful\n\t[*] --\x3e s1 : User clicks "Log in"\n  s1 --\x3e s2\n  s2 --\x3e Error : A hook fails\n  s2 --\x3e s3\n  s3 --\x3e s4 : User provides valid credentials data\n  s3 --\x3e s5 : User provides invalid credentials data\n  s5 --\x3e s3\n  s4 --\x3e Error : A hook fails\n  s4 --\x3e s6\n  s6 --\x3e [*]\n  Error --\x3e [*]\n',mdxType:"Mermaid"}),Object(o.b)("p",null,"Currently, two login methods are supported:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"password")," for signing in with an email / username and password;"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"oidc")," for signing in using a social sign in provider such as Google or Facebook.")),Object(o.b)("p",null,"Both are dis/enabled in the ORY Kratos config:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="path/to/my/kratos/config.yml"',title:'"path/to/my/kratos/config.yml"'}),"selfservice:\n  methods:\n    password:\n      enabled: true\n    oidc:\n      enabled: true\n      # ...\n")),Object(o.b)("h2",{id:"initialize-login-flow"},"Initialize Login Flow"),Object(o.b)("p",null,"The first step is to initialize the Login Flow. This allows pre-login hooks to run, set up Anti-CSRF tokens,\nand more."),Object(o.b)("h3",{id:"login-for-browser-clients"},"Login for Browser Clients"),Object(o.b)("p",null,"The Login Flow for browser clients relies on HTTP redirects between ORY Kratos, your Login UI, and the end-user's\nbrowser:"),Object(o.b)(l.a,{flows:["login"],success:"Set session cookie",interactions:['"Log in"'],mdxType:"SelfServiceBrowserFlow"}),Object(o.b)("p",null,"To initialize the Login Flow, point the Browser to\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../../self-service#initialization-and-redirect-to-ui"}),"the initialization endpoint"),":"),Object(o.b)(d.a,{items:u.e,mdxType:"CodeTabs"}),Object(o.b)("p",null,"The server responds with a HTTP 302 redirect to the Login UI, appending the ",Object(o.b)("inlineCode",{parentName:"p"},"?flow=<flow-id>")," query\nparemeter (see the curl example) to the URL configured here:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="path/to/config/kratos.yml"',title:'"path/to/config/kratos.yml"'}),"selfservice:\n  flows:\n    login:\n      # becomes http://127.0.0.1:4455/auth/login?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3\n      ui_url: http://127.0.0.1:4455/auth/login\n")),Object(o.b)("h3",{id:"login-for-api-clients"},"Login for API Clients"),Object(o.b)(r.a,{mdxType:"ApiWarning"}),Object(o.b)("p",null,"The Login Flow for API clients does not use HTTP Redirects and can be summarized as follows:"),Object(o.b)(c.a,{flows:["login"],success:"Return login session token",interactions:['"Log in"'],mdxType:"SelfServiceApiFlow"}),Object(o.b)("p",null,"To initialize the API flow (",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../reference/api#getSelfServiceLoginFlow"}),"REST API Reference"),"), the client ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../../self-service#initialization"}),"calls the API-flow initialization endpoint"),"\nwhich returns a JSON response:"),Object(o.b)(d.a,{items:u.d,mdxType:"CodeTabs"}),Object(o.b)("h2",{id:"login-flow-payloads"},"Login Flow Payloads"),Object(o.b)("p",null,"Fetching the Login Flow (",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../reference/api#get-login-flow"}),"REST API Reference"),") is usually only required for browser clients but also works\nfor Login Flows initializied by API clients. All you need is a valid flow ID:"),Object(o.b)(d.a,{items:u.a,mdxType:"CodeTabs"}),Object(o.b)("h3",{id:"login-with-usernameemail-and-password"},"Login with Username/Email and Password"),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"Before you start")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please read the\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../../concepts/credentials/username-email-password"}),"Username / Email & Password Credentials Documentation")," first."))),Object(o.b)("p",null,"When the ",Object(o.b)("inlineCode",{parentName:"p"},"password")," method is enabled, it will be part of the ",Object(o.b)("inlineCode",{parentName:"p"},"methods")," payload in the Login Flow:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'$ curl -H "Accept: application/json" -s \\\n  \'http://127.0.0.1:4434/self-service/login/flows?id=2e41015e-3b05-4e6a-8bc5-cdecf808d52e\' | jq\n\n{\n  "id": "d5c78fd6-17e7-45e2-9465-0200c76bf83a",\n  "type": "browser",\n  "expires_at": "2020-08-24T11:58:06.0780652Z",\n  "issued_at": "2020-08-24T11:48:06.0780828Z",\n  "request_url": "http://127.0.0.1:4433/self-service/registration/browser",\n  "methods": {\n    "password": {\n      "method": "password",\n      "config": {\n        "action": "http://127.0.0.1:4433/self-service/registration/methods/password?flow=d5c78fd6-17e7-45e2-9465-0200c76bf83a",\n        "method": "POST",\n        "fields": [\n          {\n            "name": "csrf_token",\n            "type": "hidden",\n            "required": true,\n            "value": "NeScRZ0rccVGilfS2dvlSjDnYk/EvhpozPKW3TBeAnpCArwCFt2La1xbxeFFnmFycdg1LngGTeA13HJ1XCccQA=="\n          },\n          {\n            "name": "password",\n            "type": "password",\n            "required": true\n          },\n          {\n            "name": "traits.email",\n            "type": "email"\n          },\n          {\n            "name": "traits.name.first",\n            "type": "text"\n          },\n          {\n            "name": "traits.name.last",\n            "type": "text"\n          }\n        ]\n      }\n    }\n  }\n}\n')),Object(o.b)("h3",{id:"login-with-google-facebook-github--openid-connect--oauth-20"},"Login with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0"),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"Before you start")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Check out the\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/kratos/docs/next/guides/sign-in-with-github-google-facebook-linkedin"}),"Sign in with GitHub, Google, ... Guide")," and learn how\nto set up this method!"))),Object(o.b)("p",null,"The Social Sign In Method (",Object(o.b)("inlineCode",{parentName:"p"},"oidc"),") enables you to use"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"http://github.com/"}),"GitHub"),";"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://developer.apple.com/sign-in-with-apple/"}),"Apple"),";"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://developers.google.com/identity/sign-in/web/sign-in"}),"Google"),";"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://developers.facebook.com/docs/facebook-login/"}),"Facebook"),";"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.ory.sh/hydra"}),"ORY Hydra"),";"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.keycloak.org"}),"Keycloak"),";"),Object(o.b)("li",{parentName:"ul"},"and every other OpenID Connect Certified Provider")),Object(o.b)("div",{className:"admonition admonition-warning alert alert--danger"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})))),"warning")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Social Sign In is currently not possible for API Clients. It will be possible in\na future version, which is partially tracked as\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/ory/kratos/issues/273"}),"kratos#273")))),Object(o.b)("p",null,"If enabled, the method contains an ",Object(o.b)("inlineCode",{parentName:"p"},"oidc")," key with the\nconfigured sign in providers as submit fields:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'$ curl -H "Accept: application/json" -s \\\n  \'http://127.0.0.1:4433/self-service/registration/flows?id=7430f336-0be0-47d1-b1fc-5cc6fcc3f228\' | jq\n\n{\n  "id": "7430f336-0be0-47d1-b1fc-5cc6fcc3f228",\n  "type": "browser",\n  "expires_at": "2020-09-03T14:32:44.060729362Z",\n  "issued_at": "2020-09-03T14:22:44.060729362Z",\n  "request_url": "http://127.0.0.1:4433/self-service/registration/browser",\n  "messages": null,\n  "methods": {\n    "oidc": {\n      "method": "oidc",\n      "config": {\n        "action": "http://127.0.0.1:4433/self-service/methods/oidc/auth/7430f336-0be0-47d1-b1fc-5cc6fcc3f228",\n        "method": "POST",\n        "fields": [\n          {\n            "name": "csrf_token",\n            "type": "hidden",\n            "required": true,\n            "value": "LJ3o59zXjukFs1004vyn3QrWDrfutW2e0Iaqo/9Ck6srYAceydRr59GEZJNFY6Walnell+r10/DlXUy/Eq6sXQ=="\n          },\n          {\n            "name": "provider",\n            "type": "submit",\n            "value": "github"\n          }\n        ]\n      }\n    }\n  }\n}\n')),Object(o.b)("h2",{id:"login-flow-form-rendering"},"Login Flow Form Rendering"),Object(o.b)("p",null,"The Login User Interface is a route (page / site) in your\napplication (server, native app, single page app) that should render\na login form."),Object(o.b)("p",null,"In stark contrast to other Identity Systems, ORY Kratos does not render this\nHTML. Instead, you need to implement the HTML code in your application (e.g.\nNodeJS + ExpressJS, Java, PHP, ReactJS, ...), which gives you extreme\nflexibility and customizability in your user interface flows and designs."),Object(o.b)("p",null,"You will use the Login Flow JSON response to render the login form UI,\nwhich could looks as follows depending on your\nprogramming language and web framework:"),Object(o.b)(p.a,{flow:"login",mdxType:"RenderFlow"}),Object(o.b)("h2",{id:"login-form-validation"},"Login Form Validation"),Object(o.b)("p",null,"The form payloads are then submitted to ORY Kratos which follows up with:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"An HTTP 302 Found redirect pointing to the Login UI for Browser Clients."),Object(o.b)("li",{parentName:"ul"},"An ",Object(o.b)("inlineCode",{parentName:"li"},"application/json")," response for API Clients.")),Object(o.b)("h3",{id:"login-with-usernameemail-and-password-1"},"Login with Username/Email and Password"),Object(o.b)("p",null,"To complete the login, the end-user fills out their identifier (username, email, phone number, ...) and\nthe password. Possible validation errors include a missing identifier or password, or invalid credentials:"),Object(o.b)(d.a,{items:u.c,mdxType:"CodeTabs"}),Object(o.b)("p",null,"When validation errors happen, browser clients receive a HTTP 302 Found redirect to the\nLogin Flow UI, containing the Login Flow ID which includes the error payloads."),Object(o.b)("p",null,"For API Clients, the server typically responds with HTTP 400 Bad Request and the\nLogin Flow in the response payload as JSON."),Object(o.b)("h3",{id:"login-with-google-facebook-github--openid-connect--oauth-20-1"},"Login with Google, Facebook, GitHub, ..., OpenID Connect / OAuth 2.0"),Object(o.b)("p",null,"Completing the ",Object(o.b)("inlineCode",{parentName:"p"},"oidc")," method requires the user to go through an OAuth 2.0\nor OpenID Connect flow which involves logging into the upstream identity\nprovider (e.g. Google) and giving consent."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"If the user has never signed in with the given provider before, a new account\nwill be created. It is also possible to link upstream identities (e.g. Google profile)\nwith an existing ORY Kratos identity."))),Object(o.b)("p",null,"A possible validation error is a missing ID Token:"),Object(o.b)(d.a,{items:u.b,mdxType:"CodeTabs"}),Object(o.b)("h2",{id:"successful-login"},"Successful Login"),Object(o.b)("p",null,"Completing the login behaves differently for Browser and API Clients."),Object(o.b)("h3",{id:"browser-clients"},"Browser Clients"),Object(o.b)("p",null,"When the login is completed successfully, ORY Kratos responds with a HTTP 302 Redirect to the\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../../concepts/browser-redirect-flow-completion"}),"configured redirect URL"),". Alongside the HTTP 302 Redirect is a ",Object(o.b)("inlineCode",{parentName:"p"},"Set-Cookie")," header which contains the ORY Kratos\nLogin Session Cookie:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"HTTP/1.1 302 Found\nCache-Control: 0\nLocation: http://127.0.0.1:4455/\nSet-Cookie: csrf_token=b8OebRPTPr5ow23mA5gIZmFNLeuMbv8pZz1jT1Ex7ys=; Path=/; Domain=127.0.0.1; Max-Age=31536000; HttpOnly\nSet-Cookie: ory_kratos_session=MTU5OTE2ODc2N3xEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJR055VlROMGRteHhSakJrUzBkbmRUUjBlVFY1V0RCRWFVTnJXVmR6V25oaHx2DICsB6IMbaHSQwnYITUZqr7Qx7CxUlnaneJWH495wQ==; Path=/; Expires=Fri, 04 Sep 2020 21:32:47 GMT; Max-Age=86400; HttpOnly; SameSite=Lax\nVary: Cookie\nDate: Thu, 03 Sep 2020 21:32:47 GMT\nContent-Length: 0\n")),Object(o.b)("p",null,"Now, whenever the browser is making a request (with cookies) to the ",Object(o.b)("inlineCode",{parentName:"p"},"http://127.0.0.1/sessions/whoami")," endpoint,\nthe session will be returned:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'curl -s -H "Cookie: ory_kratos_session=MTU5OTE2ODc2N3xEdi1CQkFFQ180SUFBUkFCRUFBQVJfLUNBQUVHYzNSeWFXNW5EQThBRFhObGMzTnBiMjVmZEc5clpXNEdjM1J5YVc1bkRDSUFJR055VlROMGRteHhSakJrUzBkbmRUUjBlVFY1V0RCRWFVTnJXVmR6V25oaHx2DICsB6IMbaHSQwnYITUZqr7Qx7CxUlnaneJWH495wQ==" \\\n  http://127.0.0.1:4433/sessions/whoami | jq\n\n{\n  "id": "ede90ce6-2420-435a-a745-3d8ab1a9636c",\n  "active": true,\n  "expires_at": "2020-09-04T21:32:47.5642404Z",\n  "authenticated_at": "2020-09-03T21:32:47.5881038Z",\n  "issued_at": "2020-09-03T21:32:47.5642688Z",\n  "identity": {\n    "id": "d96e86d9-bc33-4aa5-b865-4ade8a3974b3",\n    "schema_id": "default",\n    "schema_url": "http://127.0.0.1:4433/schemas/default",\n    "traits": {\n      "email": "foouser@ory.sh",\n      "name": {\n        "first": "foo",\n        "last": "user"\n      }\n    },\n    "verifiable_addresses": [\n      {\n        "id": "81bbdeae-6333-42f2-877e-26c78acb6ea5",\n        "value": "foouser@ory.sh",\n        "verified": false,\n        "via": "email",\n        "status": "pending",\n        "verified_at": null\n      }\n    ],\n    "recovery_addresses": [\n      {\n        "id": "596c1db4-ccaa-4f4e-9623-cb7e768026ad",\n        "value": "foouser@ory.sh",\n        "via": "email"\n      }\n    ]\n  }\n}\n')),Object(o.b)("h3",{id:"api-clients"},"API Clients"),Object(o.b)("p",null,"For API Clients, ORY Kratos responds with a JSON payload which includes the identity which\njust authenticated, the session, and the ORY Kratos Session Token:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'# Inits a Login Flow\n$ actionUrl=$(\\\n  curl -s -X GET -H "Accept: application/json" \\\n    "http://127.0.0.1:4433/self-service/login/api" \\\n    | jq -r \'.methods.password.config.action\'\\\n)\n\n# Complete Login Flow with password method\n$ curl -s -X POST -H  "Accept: application/json" -H "Content-Type: application/json" \\\n    -d \'{"identifier": "api@user.org", "password": "iohuasf0897zAJHf"}\' \\\n    "$actionUrl" | jq\n\n{\n  "session_token": "oFZzgLpsacUpUy2cvQPtrGa2046WcXCR",\n  "session": {\n    "id": "8f660ce3-69ec-4aeb-9fda-f9230dc3243f",\n    "active": true,\n    "expires_at": "2020-08-25T13:42:15.7411522Z",\n    "authenticated_at": "2020-08-24T13:42:15.7411522Z",\n    "issued_at": "2020-08-24T13:42:15.7412042Z",\n    "identity": {\n      "id": "bf32596a-f853-47c4-91e6-a3f41cf4949d",\n      "schema_id": "default",\n      "schema_url": "http://127.0.0.1:4433/schemas/default",\n      "traits": {\n        "email": "api@user.org",\n        "name": {\n          "last": "User",\n          "first": "API"\n        }\n      },\n      "verifiable_addresses": [\n        {\n          "id": "f877db6c-7dfb-45e3-bbeb-ac8349348128",\n          "value": "api@user.org",\n          "verified": false,\n          "via": "email",\n          "verified_at": null,\n          "expires_at": "2020-08-24T14:35:59.125873Z"\n        }\n      ],\n      "recovery_addresses": [\n        {\n          "id": "065a908c-82be-4110-bf67-9910f36242b7",\n          "value": "api@user.org",\n          "via": "email"\n        }\n      ]\n    }\n  }\n}\n')),Object(o.b)("p",null,"The ORY Kratos Session Token can be checked at the ",Object(o.b)("inlineCode",{parentName:"p"},"http://127.0.0.1/sessions/whoami")," endpoint:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'$ curl -s -H "Authorization: Bearer svX8bE9HTiVpMr7r55TtKtcOkLRhAq1a" \\\n  http://127.0.0.1:4433/sessions/whoami | jq\n\n{\n  "id": "d09fc470-9e11-4e70-855f-0dc1aee7e501",\n  "active": true,\n  "expires_at": "2020-09-05T10:52:52.1350455Z",\n  "authenticated_at": "2020-09-04T10:52:52.1472702Z",\n  "issued_at": "2020-09-04T10:52:52.1350737Z",\n  "identity": {\n    "id": "9ee8fb81-9d5c-47a7-9cee-28a0f64dccbb",\n    "schema_id": "default",\n    "schema_url": "http://127.0.0.1:4433/schemas/default",\n    "traits": {\n      "email": "api@user.org",\n      "name": {\n        "first": "API",\n        "last": "User"\n      }\n    },\n    "verifiable_addresses": [\n      {\n        "id": "3ba119c6-4e9a-466c-8910-40b238229aa6",\n        "value": "api@user.org",\n        "verified": false,\n        "via": "email",\n        "status": "pending",\n        "verified_at": null\n      }\n    ],\n    "recovery_addresses": [\n      {\n        "id": "9dec10d0-1079-4a5d-b1be-cd15418c640a",\n        "value": "api@user.org",\n        "via": "email"\n      }\n    ]\n  }\n}\n')),Object(o.b)("h2",{id:"refreshing-a-session"},"Refreshing a Session"),Object(o.b)("p",null,"In some cases it is required to refresh a login session. This is the case when\nupdating one's password. Refreshing a session updates the ",Object(o.b)("inlineCode",{parentName:"p"},"authenticated_at"),"\ntime."),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Refreshing a session will not log the user out, unless another user signs in."))),Object(o.b)("p",null,"To refresh a session, append ",Object(o.b)("inlineCode",{parentName:"p"},"?refresh=true")," to:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"/self-service/login/browser")," for browser Clients (e.g.\n",Object(o.b)("inlineCode",{parentName:"li"},"http://127.0.0.1:4433/self-service/login/browser?refresh=true"),")"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"/self-service/login/api")," for API Clients (e.g.\n",Object(o.b)("inlineCode",{parentName:"li"},"http://127.0.0.1:4433/self-service/login/api?refresh=true"),")")),Object(o.b)("h2",{id:"hooks"},"Hooks"),Object(o.b)("p",null,"ORY Kratos allows you to configure hooks that run before and after a Login Flow.\nThis may be helpful if you'd like to restrict logins to IPs coming from your internal network or other logic."),Object(o.b)("p",null,"For more information about hooks please read the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"../hooks"}),"Hook Documentation"),"."))}g.isMDXComponent=!0},313:function(e,t,n){"use strict";var a=n(0),i=n(19);t.a=function(){const e=Object(a.useContext)(i.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},317:function(e,t,n){"use strict";var a=n(0),i=n.n(a),o=n(331),s=n.n(o),r=n(48),l=n.n(r),c=n(326),d=n.n(c);s.a.initialize({startOnLoad:!0,logLevel:"fatal",securityLevel:"strict",arrowMarkerAbsolute:!1,theme:"neutral",flowchart:{useMaxWidth:!0,htmlLabels:!0,rankSpacing:65,nodeSpacing:30,curve:"basis"},sequence:{useMaxWidth:!0},gantt:{useMaxWidth:!0}});t.a=({chart:e})=>{const[t,n]=Object(a.useState)(!1),[o,r]=Object(a.useState)(void 0),[c]=Object(a.useState)("mermaid-"+Math.random().toString(36).substr(2,-1)),u=()=>n(!t);return Object(a.useEffect)(()=>{s.a.render(c,e,e=>{r(e)})},[]),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{onClick:u,className:d()(l.a.graph,l.a.pointer),dangerouslySetInnerHTML:{__html:o}}),i.a.createElement("div",{onClick:u,className:d()(l.a.overlay,l.a.pointer,l.a.graph,{[l.a.visible]:t})},i.a.createElement("div",{onClick:e=>e.stopPropagation(),className:d()(l.a.backdrop,l.a.graph),dangerouslySetInnerHTML:{__html:o}})))}},318:function(e,t,n){"use strict";function a(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}t.a=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(i&&(i+=" "),i+=t);return i}},321:function(e,t,n){"use strict";var a=n(0),i=n.n(a),o=n(324),s=n(318),r=n(49),l=n.n(r);const c=37,d=39;t.a=function(e){const{block:t,children:n,defaultValue:r,values:u,groupId:p}=e,{tabGroupChoices:b,setTabGroupChoices:m}=Object(o.a)(),[h,f]=Object(a.useState)(r),[g,v]=Object(a.useState)(!1);if(null!=p){const e=b[p];null!=e&&e!==h&&u.some(t=>t.value===e)&&f(e)}const w=e=>{f(e),null!=p&&m(p,e)},y=[],j=e=>{e.metaKey||e.altKey||e.ctrlKey||v(!0)},O=()=>{v(!1)};return Object(a.useEffect)(()=>{window.addEventListener("keydown",j),window.addEventListener("mousedown",O)},[]),i.a.createElement("div",null,i.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(s.a)("tabs",{"tabs--block":t})},u.map(({value:e,label:t})=>i.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":h===e,className:Object(s.a)("tabs__item",l.a.tabItem,{"tabs__item--active":h===e}),style:g?{}:{outline:"none"},key:e,ref:e=>y.push(e),onKeyDown:e=>{((e,t,n)=>{switch(n.keyCode){case d:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case c:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(y,e.target,e),j(e)},onFocus:()=>w(e),onClick:()=>{w(e),v(!1)},onPointerDown:()=>v(!1)},t))),i.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter(e=>e.props.value===h)[0]))}},322:function(e,t,n){"use strict";var a=n(0),i=n.n(a);t.a=function(e){return i.a.createElement("div",null,e.children)}},323:function(e,t,n){"use strict";var a=n(0);const i=Object(a.createContext)(void 0);t.a=i},324:function(e,t,n){"use strict";var a=n(0),i=n(323);t.a=function(){const e=Object(a.useContext)(i.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},329:function(e,t,n){"use strict";var a=n(2),i=n(0),o=n.n(i),s=n(318),r={plain:{backgroundColor:"#2a2734",color:"#9a86fd"},styles:[{types:["comment","prolog","doctype","cdata","punctuation"],style:{color:"#6c6783"}},{types:["namespace"],style:{opacity:.7}},{types:["tag","operator","number"],style:{color:"#e09142"}},{types:["property","function"],style:{color:"#9a86fd"}},{types:["tag-id","selector","atrule-id"],style:{color:"#eeebff"}},{types:["attr-name"],style:{color:"#c4b9fe"}},{types:["boolean","string","entity","url","attr-value","keyword","control","directive","unit","statement","regex","at-rule","placeholder","variable"],style:{color:"#ffcc99"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"#c4b9fe"}}]},l={Prism:n(20).a,theme:r};function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var u=/\r\n|\r|\n/,p=function(e){0===e.length?e.push({types:["plain"],content:"",empty:!0}):1===e.length&&""===e[0].content&&(e[0].empty=!0)},b=function(e,t){var n=e.length;return n>0&&e[n-1]===t?e:e.concat(t)},m=function(e,t){var n=e.plain,a=Object.create(null),i=e.styles.reduce((function(e,n){var a=n.languages,i=n.style;return a&&!a.includes(t)||n.types.forEach((function(t){var n=d({},e[t],i);e[t]=n})),e}),a);return i.root=n,i.plain=d({},n,{backgroundColor:null}),i};function h(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(n[a]=e[a]);return n}var f=function(e){function t(){for(var t=this,n=[],a=arguments.length;a--;)n[a]=arguments[a];e.apply(this,n),c(this,"getThemeDict",(function(e){if(void 0!==t.themeDict&&e.theme===t.prevTheme&&e.language===t.prevLanguage)return t.themeDict;t.prevTheme=e.theme,t.prevLanguage=e.language;var n=e.theme?m(e.theme,e.language):void 0;return t.themeDict=n})),c(this,"getLineProps",(function(e){var n=e.key,a=e.className,i=e.style,o=d({},h(e,["key","className","style","line"]),{className:"token-line",style:void 0,key:void 0}),s=t.getThemeDict(t.props);return void 0!==s&&(o.style=s.plain),void 0!==i&&(o.style=void 0!==o.style?d({},o.style,i):i),void 0!==n&&(o.key=n),a&&(o.className+=" "+a),o})),c(this,"getStyleForToken",(function(e){var n=e.types,a=e.empty,i=n.length,o=t.getThemeDict(t.props);if(void 0!==o){if(1===i&&"plain"===n[0])return a?{display:"inline-block"}:void 0;if(1===i&&!a)return o[n[0]];var s=a?{display:"inline-block"}:{},r=n.map((function(e){return o[e]}));return Object.assign.apply(Object,[s].concat(r))}})),c(this,"getTokenProps",(function(e){var n=e.key,a=e.className,i=e.style,o=e.token,s=d({},h(e,["key","className","style","token"]),{className:"token "+o.types.join(" "),children:o.content,style:t.getStyleForToken(o),key:void 0});return void 0!==i&&(s.style=void 0!==s.style?d({},s.style,i):i),void 0!==n&&(s.key=n),a&&(s.className+=" "+a),s}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.Prism,n=e.language,a=e.code,i=e.children,o=this.getThemeDict(this.props),s=t.languages[n];return i({tokens:function(e){for(var t=[[]],n=[e],a=[0],i=[e.length],o=0,s=0,r=[],l=[r];s>-1;){for(;(o=a[s]++)<i[s];){var c=void 0,d=t[s],m=n[s][o];if("string"==typeof m?(d=s>0?d:["plain"],c=m):(d=b(d,m.type),m.alias&&(d=b(d,m.alias)),c=m.content),"string"==typeof c){var h=c.split(u),f=h.length;r.push({types:d,content:h[0]});for(var g=1;g<f;g++)p(r),l.push(r=[]),r.push({types:d,content:h[g]})}else s++,t.push(d),n.push(c),a.push(0),i.push(c.length)}s--,t.pop(),n.pop(),a.pop(),i.pop()}return p(r),l}(void 0!==s?t.tokenize(a,s,n):[a]),className:"prism-code language-"+n,style:void 0!==o?o.root:{},getLineProps:this.getLineProps,getTokenProps:this.getTokenProps})},t}(i.Component),g=n(348),v=n.n(g),w=n(349),y=n.n(w),j=n(313),O={plain:{color:"#bfc7d5",backgroundColor:"#292d3e"},styles:[{types:["comment"],style:{color:"rgb(105, 112, 152)",fontStyle:"italic"}},{types:["string","inserted"],style:{color:"rgb(195, 232, 141)"}},{types:["number"],style:{color:"rgb(247, 140, 108)"}},{types:["builtin","char","constant","function"],style:{color:"rgb(130, 170, 255)"}},{types:["punctuation","selector"],style:{color:"rgb(199, 146, 234)"}},{types:["variable"],style:{color:"rgb(191, 199, 213)"}},{types:["class-name","attr-name"],style:{color:"rgb(255, 203, 107)"}},{types:["tag","deleted"],style:{color:"rgb(255, 85, 114)"}},{types:["operator"],style:{color:"rgb(137, 221, 255)"}},{types:["boolean"],style:{color:"rgb(255, 88, 116)"}},{types:["keyword"],style:{fontStyle:"italic"}},{types:["doctype"],style:{color:"rgb(199, 146, 234)",fontStyle:"italic"}},{types:["namespace"],style:{color:"rgb(178, 204, 214)"}},{types:["url"],style:{color:"rgb(221, 221, 221)"}}]},k=n(330);var N=()=>{const{siteConfig:{themeConfig:{prism:e={}}}}=Object(j.a)(),{isDarkTheme:t}=Object(k.a)(),n=e.theme||O,a=e.darkTheme||n;return t?a:n},T=n(50),x=n.n(T);const C=/{([\d,-]+)}/,S=(e=["js","jsBlock","jsx","python","html"])=>{const t={js:{start:"\\/\\/",end:""},jsBlock:{start:"\\/\\*",end:"\\*\\/"},jsx:{start:"\\{\\s*\\/\\*",end:"\\*\\/\\s*\\}"},python:{start:"#",end:""},html:{start:"\x3c!--",end:"--\x3e"}},n=["highlight-next-line","highlight-start","highlight-end"].join("|"),a=e.map(e=>`(?:${t[e].start}\\s*(${n})\\s*${t[e].end})`).join("|");return new RegExp(`^\\s*(?:${a})\\s*$`)},L=/title=".*"/;t.a=({children:e,className:t,metastring:n})=>{const{siteConfig:{themeConfig:{prism:r={}}}}=Object(j.a)(),[c,d]=Object(i.useState)(!1),[u,p]=Object(i.useState)(!1);Object(i.useEffect)(()=>{p(!0)},[]);const b=Object(i.useRef)(null);let m=[],h="";const g=N();if(n&&C.test(n)){const e=n.match(C)[1];m=y.a.parse(e).filter(e=>e>0)}n&&L.test(n)&&(h=n.match(L)[0].split("title=")[1].replace(/"+/g,""));let w=t&&t.replace(/language-/,"");!w&&r.defaultLanguage&&(w=r.defaultLanguage);let O=e.replace(/\n$/,"");if(0===m.length&&void 0!==w){let t="";const n=(e=>{switch(e){case"js":case"javascript":case"ts":case"typescript":return S(["js","jsBlock"]);case"jsx":case"tsx":return S(["js","jsBlock","jsx"]);case"html":return S(["js","jsBlock","html"]);case"python":case"py":return S(["python"]);default:return S()}})(w),a=e.replace(/\n$/,"").split("\n");let i;for(let e=0;e<a.length;){const o=e+1,s=a[e].match(n);if(null!==s){switch(s.slice(1).reduce((e,t)=>e||t,void 0)){case"highlight-next-line":t+=o+",";break;case"highlight-start":i=o;break;case"highlight-end":t+=`${i}-${o-1},`}a.splice(e,1)}else e+=1}m=y.a.parse(t),O=a.join("\n")}const k=()=>{v()(O),d(!0),setTimeout(()=>d(!1),2e3)};return o.a.createElement(f,Object(a.a)({},l,{key:String(u),theme:g,code:O,language:w}),({className:e,style:t,tokens:n,getLineProps:i,getTokenProps:r})=>o.a.createElement(o.a.Fragment,null,h&&o.a.createElement("div",{style:t,className:x.a.codeBlockTitle},h),o.a.createElement("div",{className:x.a.codeBlockContent},o.a.createElement("button",{ref:b,type:"button","aria-label":"Copy code to clipboard",className:Object(s.a)(x.a.copyButton,{[x.a.copyButtonWithTitle]:h}),onClick:k},c?"Copied":"Copy"),o.a.createElement("div",{tabIndex:0,className:Object(s.a)(e,x.a.codeBlock,{[x.a.codeBlockWithTitle]:h})},o.a.createElement("div",{className:x.a.codeBlockLines,style:t},n.map((e,t)=>{1===e.length&&""===e[0].content&&(e[0].content="\n");const n=i({line:e,key:t});return m.includes(t+1)&&(n.className=n.className+" docusaurus-highlight-code-line"),o.a.createElement("div",Object(a.a)({key:t},n),e.map((e,t)=>o.a.createElement("span",Object(a.a)({key:t},r({token:e,key:t})))))}))))))}},330:function(e,t,n){"use strict";var a=n(0),i=n(346);t.a=function(){const e=Object(a.useContext)(i.a);if(null==e)throw new Error("`useThemeContext` is used outside of `Layout` Component. See https://v2.docusaurus.io/docs/theme-classic#usethemecontext.");return e}},332:function(e,t){},333:function(e,t){},334:function(e,t){},335:function(e,t){},336:function(e,t){},337:function(e,t){},338:function(e,t){},339:function(e,t){},340:function(e,t){},341:function(e,t){},342:function(e,t){},343:function(e,t){},344:function(e,t){},345:function(e,t,n){var a={"./locale":320,"./locale.js":320};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}i.keys=function(){return Object.keys(a)},i.resolve=o,e.exports=i,i.id=345},346:function(e,t,n){"use strict";var a=n(0);const i=n.n(a).a.createContext(void 0);t.a=i},348:function(e,t,n){"use strict";const a=(e,{target:t=document.body}={})=>{const n=document.createElement("textarea"),a=document.activeElement;n.value=e,n.setAttribute("readonly",""),n.style.contain="strict",n.style.position="absolute",n.style.left="-9999px",n.style.fontSize="12pt";const i=document.getSelection();let o=!1;i.rangeCount>0&&(o=i.getRangeAt(0)),t.append(n),n.select(),n.selectionStart=0,n.selectionEnd=e.length;let s=!1;try{s=document.execCommand("copy")}catch(r){}return n.remove(),o&&(i.removeAllRanges(),i.addRange(o)),a&&a.focus(),s};e.exports=a,e.exports.default=a},349:function(e,t){e.exports.parse=function(e){var t=e.split(",").map((function(e){return function(e){if(/^-?\d+$/.test(e))return parseInt(e,10);var t;if(t=e.match(/^(-?\d+)(-|\.\.\.?|\u2025|\u2026|\u22EF)(-?\d+)$/)){var n=t[1],a=t[2],i=t[3];if(n&&i){var o=[],s=(n=parseInt(n))<(i=parseInt(i))?1:-1;"-"!=a&&".."!=a&&"\u2025"!=a||(i+=s);for(var r=n;r!=i;r+=s)o.push(r);return o}}return[]}(e)}));return 0===t.length?[]:1===t.length?Array.isArray(t[0])?t[0]:t:t.reduce((function(e,t){return Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),e.concat(t)}))}},360:function(e,t,n){"use strict";var a=n(0),i=n.n(a),o=n(317);const s=({flows:e=["login","registration","settings","..."],interactions:t=['"Log in"','"Sign Up"','"Update Email"',"..."],success:n="Perform flow-specific action (e.g. create user, set session cookie, ...)"})=>{const a=e.length>1?`<${e.join("|")}>`:""+e.join("|");return`\nsequenceDiagram\n\n  participant B as Browser\n  participant K as ORY Kratos\n  participant A as Flow UI\n\n  B->>K: Follow link to /self-service/${a}/browser\n  K--\x3e>K: Create and store new ${e.join(", ")} flow\n  K->>B: HTTP 302 Found <selfservice.flows.${a}.ui_url>?flow=<flow-id>\n\n  B->>A: Opens <selfservice.flows.<${e.join("|")}>.ui_url>?flow=<flow-id>\n  A--\x3e>K: Fetches data to render forms using /selfservice/${a}/flows?id=<flow-id>\n  B--\x3e>A: Fills out forms, clicks e.g. ${t.join(", ")}\n  B->>K: Submits form\n  K--\x3e>K: Validates and processes form payloads\n\n  alt Form payload is valid valid\n    K->>B: ${n}\n  else Login data invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K--\x3e>B: HTTP 302 Found <selfservice.flows.${a}.ui_url>?flow=<flow-id>\n    B->>A: Opens <selfservice.flows.${a}?flow=<flow-id>\n    A--\x3e>K: Fetches data to render form fields and errors\n    B->>K: Repeat flow with input data, submit, validate, ...\n  end\n`};t.a=e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(o.a,{chart:s(e)}),i.a.createElement("p",null,"The ",i.a.createElement("em",null,"Flow UI")," (",i.a.createElement("strong",null,"your application!"),') is responsible for rendering the actual Login and Registration HTML Forms. You can of course implement one app for rendering all the Login, Registration, ... screens, and another app (think "Service Oriented Architecture", "Micro-Services" or "Service Mesh") is responsible for rendering your Dashboards, Management Screens, and so on.'))},361:function(e,t,n){"use strict";var a=n(0),i=n.n(a),o=n(317);const s=({flows:e=["login","registration","settings","..."],methods:t=["password","oidc","..."],interactions:n=['"Log in"','"Sign Up"','"Update Email"',"..."],success:a="Perform flow-specific action (e.g. create user, set session cookie, ...)"})=>{const i=e.length>1?`<${e.join("|")}>`:""+e.join("|");return`\nsequenceDiagram\n  participant B as API Client\n  participant K as ORY Kratos\n\n  B->>K: REST GET /self-service/${i}/api\n  K--\x3e>K: Create and store new ${e.join(", ")} flow\n  K->>B: HTTP 200 OK with flow as application/json payload\n  B--\x3e>B: Render form using e.g. Native iOS UI Elements\n  B--\x3e>B: User fills out forms, clicks e.g. ${n}\n  B->>K: REST POST to e.g. /self-service/${i}/methods/<${t.join("|")}>\n  K--\x3e>K: Validates and processes payload\n  alt Form payload is valid valid\n    K->>B: ${a}\n  else Login data invalid\n    K--\x3e>K: Update and store flow (e.g. add form validation errors)\n    K->>B: Respond with e.g. HTTP 400 Bad Request and updated flow as payload\n    B--\x3e>B: Render form and validation errors using e.g. Native iOS UI Elements\n    B--\x3e>K: Repeat flow with input data, submit, validate, ...\n  end\n`};t.a=e=>i.a.createElement(o.a,{chart:s(e)})},362:function(e,t,n){"use strict";var a=n(321),i=n(322),o=n(0),s=n.n(o),r=n(329);t.a=({items:e})=>s.a.createElement(a.a,{defaultValue:Object.keys(e)[0],values:Object.keys(e).map(t=>({label:e[t].label,value:t}))},Object.keys(e).map(t=>s.a.createElement(i.a,{key:t,value:t},e[t].code?s.a.createElement(r.a,{className:"language-"+e[t].language,children:e[t].code}):s.a.createElement("img",{src:e[t].image,alt:e[t].alt}))))},368:function(e,t,n){"use strict";var a=n(0),i=n.n(a);t.a=()=>i.a.createElement("div",{className:"admonition admonition-warning alert alert--danger"},i.a.createElement("div",{className:"admonition-heading"},i.a.createElement("h5",null,i.a.createElement("span",{className:"admonition-icon"},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},i.a.createElement("path",{"fill-rule":"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),i.a.createElement("div",{className:"admonition-content"},i.a.createElement("p",null,"Never use API flows to implement Browser applications!"),i.a.createElement("p",null,"Using API flows in Single-Page-Apps as well as server-side apps opens up several potential attack vectors, including including Login and other CSRF attacks.")))},369:function(e,t,n){"use strict";var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a)return a;throw new Error("unable to locate global object")}();e.exports=t=a.fetch,t.default=a.fetch.bind(a),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},370:function(e,t,n){"use strict";var a=n(321),i=n(322),o=n(0),s=n.n(o),r=n(369),l=n.n(r),c=n(329);var d=({src:e,link:t})=>{const[n,a]=Object(o.useState)("");return Object(o.useEffect)(()=>{l()(e).then(e=>e.text()).then(a).catch(console.err)},[]),s.a.createElement(s.a.Fragment,null,s.a.createElement(c.a,{metastring:t&&`title="${t}"`,className:"language-typescript",children:n}))},u=n.p+"assets/images/browser-61597c2d37644d2e9a6cd62143a17d19.png",p=n.p+"assets/images/browser-3fffa4ddf3b8dbaa9171845af0b1ace3.png",b=n.p+"assets/images/browser-95c5fd81e495c104256cf0460ebd835a.png",m=n.p+"assets/images/browser-22673e53b8fd2d5b86732105f965b818.png";t.a=({flow:e})=>{let t;switch(e){case"registration":t=s.a.createElement("img",{src:b,alt:"User Registration HTML Form"});break;case"login":t=s.a.createElement("img",{src:u,alt:"User Login HTML Form"});break;case"settings":t=s.a.createElement("img",{src:p,alt:"Profile Settings HTML Form"});break;case"recovery":t=s.a.createElement("img",{src:m,alt:"Account Recovery HTML Form"});break;case"verification":t=s.a.createElement("img",{src:m,alt:"Email Verification HTML Form"})}return s.a.createElement(a.a,{defaultValue:"browser",values:[{label:"Browser UI",value:"browser"},{label:"ExpressJS & Handlebars",value:"express"},{label:"ReactJS",value:"react"},{label:"React Native",value:"react-native"}]},s.a.createElement(i.a,{value:"browser"},t),s.a.createElement(i.a,{value:"express"},s.a.createElement(d,{link:`https://github.com/ory/kratos-selfservice-ui-node/blob/master/src/routes/${e}.ts`,src:`https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/src/routes/${e}.ts`}),"The views can be rather simple, as ORY Kratos provides you with all the information you need for rendering the forms. The following examples use Handlebars and a generic form generator to render the Flow:",s.a.createElement(a.a,{defaultValue:"view",values:[{label:(n=e,n.charAt(0).toUpperCase()+n.slice(1))+" View",value:"view"},{label:"Generic Form View",value:"generic-form"},{label:"Example Input Form Element",value:"input-form"}]},s.a.createElement(i.a,{value:"view"},s.a.createElement(d,{link:`https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/${e}.hbs`,src:`https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/${e}.hbs`})),s.a.createElement(i.a,{value:"generic-form"},s.a.createElement(d,{link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/form.hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/form.hbs"})),s.a.createElement(i.a,{value:"input-form"},s.a.createElement(d,{link:"https://github.com/ory/kratos-selfservice-ui-node/blob/master/views/partials/form_input_default.hbs",src:"https://raw.githubusercontent.com/ory/kratos-selfservice-ui-node/master/views/partials/form_input_default.hbs"}))),"The rest of the form partials can be found"," ",s.a.createElement("a",{href:"https://github.com/ory/kratos-selfservice-ui-node/tree/master/views/partials"},"here"),"."),s.a.createElement(i.a,{value:"react"},"A React example is currently in the making."),s.a.createElement(i.a,{value:"react-native"},"A React Native example is currently in the making."));var n}},471:function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return r}));const a={curl:{label:"Raw HTTP",language:"shell",code:n(472).default},html:{label:"HTML",language:"html",code:n(473).default},jsx:{label:"ReactJS",language:"js",code:n(474).default},node:{label:"Angular",language:"html",code:n(475).default},angular:{label:"ExpressJS",language:"js",code:n(476).default}},i={curl:{label:"Raw HTTP",language:"shell",code:n(477).default},js:{label:"JavaScript SDK",language:"js",code:n(478).default},go:{label:"Go SDK",language:"go",code:n(479).default}},o={curl:{label:"Raw HTTP",language:"shell",code:n(480).default},js:{label:"Node",language:"js",code:n(481).default},go:{label:"Go",language:"go",code:n(482).default}},s={browser:{label:"Browser UI",image:n(483).default,alt:"User Login HTML Form with validation errors"},missing:{label:"Missing Email",language:"shell",code:n(484).default},wrong:{label:"Wrong Credentials",language:"shell",code:n(485).default}},r={missing:{label:"Missing ID Token",language:"shell",code:n(486).default}}},472:function(e,t,n){"use strict";n.r(t),t.default='curl -s -v -X GET \\\n  -H "Accept: text/html"  \\\n  http://127.0.0.1:4433/self-service/login/browser\n\n> GET /self-service/login/browser HTTP/1.1\n> Host: 127.0.0.1:4433\n> User-Agent: curl/7.64.1\n> Accept: text/html\n>\n< HTTP/1.1 302 Found\n< Cache-Control: 0\n< Content-Type: text/html; charset=utf-8\n< Location: http://127.0.0.1:4455/auth/login?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3\n< Set-Cookie: csrf_token=y4Ocu6V83BapwJwbPw/pnlRHHw40DZbjq5iuDrxl0Ds=; Path=/; Domain=127.0.0.1; Max-Age=31536000; HttpOnly\n<\n<a href="http://127.0.0.1:4455/auth/login?flow=df607aa1-d555-4b2a-b3e4-0f5a1d2fe6f3">Found</a>.\n'},473:function(e,t,n){"use strict";n.r(t),t.default='<a href="http://127.0.0.1:4433/self-service/login/browser">Log in</a>\n\n\x3c!-- or --\x3e\n\n<script>\n  const initLogin = () => {\n    window.location.href = \'http://127.0.0.1:4433/self-service/login/browser\'\n  }\n<\/script>\n\n<a onClick="initLogin">Sign in</a>\n'},474:function(e,t,n){"use strict";n.r(t),t.default="import React from 'react'\n\nconst MyComponent = () => (\n  <a href=\"http://127.0.0.1:4433/self-service/login/browser\">Sign in</a>\n)\n"},475:function(e,t,n){"use strict";n.r(t),t.default="express.get('/login', function (req, res) {\n  res.redirect(302, 'http://127.0.0.1:4433/self-service/login/browser')\n})\n"},476:function(e,t,n){"use strict";n.r(t),t.default='<a href="http://127.0.0.1:4433/self-service/login/browser">Log in</a>\n'},477:function(e,t,n){"use strict";n.r(t),t.default='$ curl -H "Accept: application/json" -s\n    \'http://127.0.0.1:4434/self-service/login/flows?id=7c4260f5-55ad-470a-b1d4-e72dd011e4fe\' | jq\n\n{\n  "id": "7c4260f5-55ad-470a-b1d4-e72dd011e4fe",\n  "type": "browser",\n  "expires_at": "2020-08-24T12:01:46.0750749Z",\n  "issued_at": "2020-08-24T11:51:46.0750749Z",\n  "request_url": "http://127.0.0.1:4433/self-service/login/browser",\n  "active": "password",\n  "methods": {\n    // password ...\n    // oidc ...\n  },\n  "forced": false\n}\n'},478:function(e,t,n){"use strict";n.r(t),t.default="import {CommonApi} from '@oryd/kratos-client'\n\nconst kratos = new CommonApi('http://127.0.0.1:4433/')\n\nconst flowId = '' // usually something like: req.query.flow\n\nkratos.getSelfServiceLoginFlow(flowId)\n  .then(({body}) => {\n    console.log(body) // see the Raw HTTP tab for the payload\n  })\n"},479:function(e,t,n){"use strict";n.r(t),t.default='package samples\n\nimport (\n  "fmt"\n\n  "github.com/ory/kratos-client-go/client/public"\n  "github.com/ory/kratos-client-go/client"\n\n  "github.com/ory/kratos/internal/httpclient/client/common"\n)\n\nfunc main() {\n  c := client.NewHTTPClientWithConfig(nil,\n    &client.TransportConfig{Host: "127.0.0.1:4433", BasePath: "/", Schemes: []string{"http"}})\n\n  flowID := "" // Usually something like: res.Request.URL.Query().Get("flow")\n\n  rs, err := c.Common.GetSelfServiceLoginFlow(\n    common.NewGetSelfServiceLoginFlowParams().\n      WithID(flowID),\n  )\n\n  fmt.Printf("%+v", rs.Payload) //\n}\n'},480:function(e,t,n){"use strict";n.r(t),t.default='$ curl -s -X GET \\\n  -H "Accept: application/json"  \\\n  http://127.0.0.1:4433/self-service/login/api | jq\n\n{\n  "id": "6bb7f2a2-a2f2-44cd-9d14-ee7ca876d60b",\n  "type": "api",\n  "expires_at": "2020-09-03T20:04:57.37098805Z",\n  "issued_at": "2020-09-03T19:54:57.37098805Z",\n  "request_url": "http://127.0.0.1:4433/self-service/login/api",\n  "methods": {\n    // password,\n    // oidc,\n    // ...\n  },\n  "forced": false\n}\n'},481:function(e,t,n){"use strict";n.r(t),t.default="import {PublicApi} from '@oryd/kratos-client'\n\nconst kratos = new PublicApi('http://127.0.0.1:4433/')\nkratos.initializeSelfServiceLoginViaAPIFlow()\n  .then(({body}) => {\n    console.log(body) // see the Raw HTTP tab for the payload\n  })\n"},482:function(e,t,n){"use strict";n.r(t),t.default='package api\n\nimport (\n  "fmt"\n\n  "github.com/ory/kratos-client-go/client/public"\n  "github.com/ory/kratos-client-go/client"\n)\n\nfunc main() {\n  c := client.NewHTTPClientWithConfig(nil,\n    &client.TransportConfig{Host: "127.0.0.1:4433", BasePath: "/", Schemes: []string{"http"}})\n\n  rs, _ := c.Public.InitializeSelfServiceLoginViaAPIFlow(public.\n    NewInitializeSelfServiceLoginViaAPIFlowParams())\n\n  fmt.Printf("%+v", rs.Payload)\n}\n'},483:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/browser-error-b6509d4065a4bfb5ab01e37a0389a65f.png"},484:function(e,t,n){"use strict";n.r(t),t.default='$ curl -H "Accept: application/json" -s \\\n    \'http://127.0.0.1:4433/self-service/login/flows?id=2e41015e-3b05-4e6a-8bc5-cdecf808d52e\' \\\n    | jq -r \'.methods.password.config\'\n\n{\n  "action": "http://127.0.0.1:4433/self-service/login/methods/password?flow=2e41015e-3b05-4e6a-8bc5-cdecf808d52e",\n  "method": "POST",\n  "fields": [\n    {\n      "name": "identifier",\n      "type": "text",\n      "required": true,\n      "value": "foo@ory.sh"\n    },\n    {\n      "name": "password",\n      "type": "password",\n      "required": true,\n      "messages": [\n        {\n          "id": 4000001,\n          "text": "length must be >= 1, but got 0",\n          "type": "error"\n        }\n      ]\n    },\n    {\n      "name": "csrf_token",\n      "type": "hidden",\n      "required": true,\n      "value": "iOINjfSS6WycVC9sDCzMgK0dGUCyBfTTwRyKUz4DoSI62z0AYmd+ckzRVZsMZ6gzG/xJd359tJHibOKkDM2Lcw=="\n    }\n  ]\n}\n'},485:function(e,t,n){"use strict";n.r(t),t.default='$ curl -H "Accept: application/json" -s \\\n    \'http://127.0.0.1:4433/self-service/registration/flows?id=cb264cfa-31d4-40cf-bb74-1c61abd7d298\' \\\n    | jq -r \'.methods.password.config\'\n\n{\n  "action": "http://127.0.0.1:4433/self-service/registration/methods/password?flow=cb264cfa-31d4-40cf-bb74-1c61abd7d298",\n  "method": "POST",\n  "fields": [\n    {\n      "name": "csrf_token",\n      "type": "hidden",\n      "required": true,\n      "value": "SRJdmk6+47L79ydSXNQyMIvfFChL51uZ16nTYw2WntUPNu5IWKzyJt9VmOTFPe6S3e/HqcVD/98dZorkreFGRg=="\n    },\n    {\n      "name": "password",\n      "type": "password",\n      "required": true,\n      "messages": [\n        {\n          "id": 4000005,\n          "text": "The password can not be used because the password has been found in at least 23597311 data breaches and must no longer be used..",\n          "type": "error",\n          "context": {\n            "reason": "the password has been found in at least 23597311 data breaches and must no longer be used."\n          }\n        }\n      ]\n    },\n    {\n      "name": "traits.email",\n      "type": "text",\n      "value": "foo@ory.sh"\n    },\n    {\n      "name": "traits.name.first",\n      "type": "text",\n      "value": ""\n    },\n    {\n      "name": "traits.name.last",\n      "type": "text",\n      "value": ""\n    }\n  ]\n}\n'},486:function(e,t,n){"use strict";n.r(t),t.default='$ curl -s -H "Accept: application/json" \\\n  \'http://127.0.0.1:4433/self-service/registration/flows?id=2e87577f-1209-407c-b523-4727d7bbdbd4\' \\\n  | jq -r \'methods.oidc.config\'\n\n{\n  "action": "http://127.0.0.1:4433/self-service/methods/oidc/auth/2e87577f-1209-407c-b523-4727d7bbdbd4",\n  "method": "POST",\n  "messages": [\n    {\n      "id": 4000000,\n      "type": "error",\n      "text": "Authentication failed because no id_token was returned. Please accept the \\"openid\\" permission and try again."\n    }\n  ],\n  "fields": [\n    {\n      "name": "csrf_token",\n      "type": "hidden",\n      "required": true,\n      "value": "O0e8KWxx1zZeNEgUOxNFvV8dVMrK63MXoxU102lj9n0nXcsaDWXhPn0TiZG3Nk+nLi/pT1wjTUsHniLRKOpp3w=="\n    },\n    {\n      "name": "provider",\n      "type": "submit",\n      "value": "github"\n    }\n  ]\n}\n'}}]);