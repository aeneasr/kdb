<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-71865250-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="ORY Kratos" href="/kratos/docs/opensearch.xml"><title data-react-helmet="true">Social Sign In, OpenID Connect, and OAuth2 | ORY Kratos</title><meta data-react-helmet="true" name="docsearch:version" content="next"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Social Sign In, OpenID Connect, and OAuth2 | ORY Kratos"><meta data-react-helmet="true" name="description" content="The oidc method uses OpenID Connect, or OAuth2 where OpenID Connect is not"><meta data-react-helmet="true" property="og:description" content="The oidc method uses OpenID Connect, or OAuth2 where OpenID Connect is not"><meta data-react-helmet="true" property="og:url" content="https://www.ory.sh//kratos/docs/next/concepts/credentials/openid-connect-oidc-oauth2"><link data-react-helmet="true" rel="shortcut icon" href="/kratos/docs/img/favico.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://www.ory.sh//kratos/docs/next/concepts/credentials/openid-connect-oidc-oauth2"><link rel="stylesheet" href="/kratos/docs/styles.9e1fc63f.css">
<link rel="preload" href="/kratos/docs/styles.47fe7342.js" as="script">
<link rel="preload" href="/kratos/docs/runtime~main.25132285.js" as="script">
<link rel="preload" href="/kratos/docs/main.ad3de72d.js" as="script">
<link rel="preload" href="/kratos/docs/2.3f0cafd9.js" as="script">
<link rel="preload" href="/kratos/docs/3.9748f2ba.js" as="script">
<link rel="preload" href="/kratos/docs/1be78505.d928f7bc.js" as="script">
<link rel="preload" href="/kratos/docs/eb6fb697.9e49424f.js" as="script">
<link rel="preload" href="/kratos/docs/255.5a2f44ed.js" as="script">
<link rel="preload" href="/kratos/docs/254.7bfb09c2.js" as="script">
<link rel="preload" href="/kratos/docs/86d007ba.9e11e37f.js" as="script">
<link rel="preload" href="/kratos/docs/17896441.b979b995.js" as="script">
<link rel="preload" href="/kratos/docs/56ff8f6b.be9122ea.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/kratos/docs/">Docs</a><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Ecosystem</a><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forum</a><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat</a><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/kratos/docs/versions">v0.4</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.ory.sh/kratos" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img class="navbar__logo" src="/kratos/docs/img/logo-kratos.svg" alt="ORY Kratos"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/">Docs</a></li><li class="menu__list-item"><a href="https://www.ory.sh/docs" target="_blank" rel="noopener noreferrer" class="menu__link">Ecosystem</a></li><li class="menu__list-item"><a href="https://www.ory.sh/blog" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://community.ory.sh" target="_blank" rel="noopener noreferrer" class="menu__link">Forum</a></li><li class="menu__list-item"><a href="https://www.ory.sh/chat" target="_blank" rel="noopener noreferrer" class="menu__link">Chat</a></li><li class="menu__list-item"><a href="https://github.com/ory/kratos" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/kratos/docs/versions">v0.4</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/quickstart">Quickstart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/configuring">Configuring</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/terminology">Terminology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/ui-user-interface">User Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/identity-user-model">Identity Data Model</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Identity Credentials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/credentials">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/credentials/username-email-password">Username / Email &amp; Password</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/kratos/docs/next/concepts/credentials/openid-connect-oidc-oauth2">Social Sign In, OpenID Connect, and OAuth2</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/browser-redirect-flow-completion">HTTP Redirection Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/email-sms">Out-of-band communication via E-Mail and SMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/rest-api">REST API Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/federation">Federation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kratos/docs/next/concepts/security">Threat Models and Security Profiles</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Self Service (End-User)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service">Concepts and Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/user-registration">User Registration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/user-login">User Login</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/user-settings">User Settings and Profile Updates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/account-recovery">Account Recovery and Password Reset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/verify-email-account-activation">Email and Phone Verification and Account Activation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/user-logout">User Logout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/user-facing-errors">User-Facing Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/flows/2fa-mfa-multi-factor-authentication">MFA / 2FA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/self-service/hooks">Hooks</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/admin/managing-users-identities">Managing Users and Identities</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/sign-in-with-github-google-facebook-linkedin">Sign in with GitHub, Google, Facebook, LinkedIn, Microsoft ...</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/zero-trust-iap-proxy-identity-access-proxy">Zero Trust with IAP Proxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/account-recovery-password-reset">Setting up Account Recovery and Password Reset</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/account-activation-email-verification">Setting up Account Activation and E-Mail Verification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/multi-tenancy-multitenant">Multitenancy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/configuring-cookies">Configuring Cookies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/login-session">Configuring And Checking for Login Sessions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/secret-key-rotation">Secret and Key Rotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/high-availability-ha">High Availability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/guides/docker">Docker Images</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/reference/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/reference/json-schema-json-paths">JSON Schema and JSON Paths</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/reference/html-forms">HTML Form Parser</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/reference/api">REST API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Debug &amp; Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/debug/csrf">Common Cookie and CSRF Pitfalls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SDKs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/sdk">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/milestones">Milestones and Roadmap</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Further Reading</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/further-reading/comparison">Comparison</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/kratos/docs/next/further-reading/kratos-video-tutorials">Video Tutorials</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Hydra</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/hydra" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/hydra/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/hydra" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Oathkeeper</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/oathkeeper/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/oathkeeper" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ORY Keto</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.ory.sh/keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Home</a></li><li class="menu__list-item"><a href="https://www.ory.sh/keto/docs" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Docs</a></li><li class="menu__list-item"><a href="https://github.com/ory/keto" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">GitHub</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for ORY Kratos <strong>next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/kratos/docs/concepts/credentials/openid-connect-oidc-oauth2">latest version</a></strong> (v0.4).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: next</span></div><header><h1 class="docTitle_1Lrw">Social Sign In, OpenID Connect, and OAuth2</h1></header><div class="markdown"><p>The <code>oidc</code> method uses OpenID Connect, or OAuth2 where OpenID Connect is not
supported, to authenticate identities using a third-party identity provider,
such as Google, Microsoft, GitHub - or any other OAuth2 / OpenID Connect
provider (for example <a href="https://www.ory.sh/hydra" target="_blank" rel="noopener noreferrer">ORY Hydra</a>). &quot;Social Sign In&quot;
or &quot;Sign in with ...&quot; are common aliases for this flow.</p><p>This strategy expects that you&#x27;ve set up your
<a href="/kratos/docs/next/concepts/identity-user-model">Default Identity JSON Schema</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><p>You can configure multiple OAuth2 / OpenID Connect providers. First, enable the
<code>oidc</code> method:</p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">path/to/my/kratos/config.yml</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># $ kratos -c path/to/my/kratos/config.yml serve</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">selfservice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span></div></div></div></div></div><p>Next, you need to configure the providers you want to use (e.g. GitHub).</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The most important configuration key is the provider&#x27;s <code>id</code>. Once set, you
should never remove or change that <code>id</code>. Otherwise, your existing users will no
longer be able to sign in.</p></div></div><p>The provider configuration looks as follows:</p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">path/to/my/kratos/config.yml</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># $ kratos -c path/to/my/kratos/config.yml serve</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">selfservice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">providers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># REQUIRED - The ID of the provider.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># DO NOT change this once this is in use.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> github</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># REQUIRED - The provider you would like to use. ORY Kratos comes with some predefined providers to make</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># life easier for you, but you can always opt for the &quot;generic&quot; provider, which works</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># with any Certified OpenID Connect Provider (Google, ORY Hydra, ...):</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   provider: github</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   provider: google</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#   .... more to come</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> generic</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># REQUIRED - See section &quot;Data Mapping with Jsonnet&quot; for more information.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">mapper_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//mydomain.com/github.schema.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># The OAuth2 / OpenID Connect provider will provide you with a OAuth2 Client ID and Client Secret. You need</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># to set them here:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">client_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">client_secret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># What scope to request. Usually, this would be something like &quot;profile&quot; or &quot;email&quot;.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Please check the documentation of the OAuth2 / OpenID Connect provider to see what&#x27;s allowed here.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> email</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># issuer_url is the OpenID Connect Server URL. You can leave this empty if `provider` is not set to `generic`.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># If set, neither `auth_url` nor `token_url` are required.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">issuer_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//openid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">provider/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># auth_url is the authorize url, typically something like: https://example.org/oauth2/auth</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Should only be used when the OAuth2 / OpenID Connect server is not supporting OpenID Connect Discovery and when</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># `provider` is set to `generic`.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">auth_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//openid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">provider/oauth2/auth</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># token_url is the token url, typically something like: https://example.org/oauth2/token</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Should only be used when the OAuth2 / OpenID Connect server is not supporting OpenID Connect Discovery and when</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># `provider` is set to `generic`.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">token_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//openid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">provider/oauth2/token</span></div></div></div></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>It is very important to add the &quot;session&quot; hook to the after oidc registration
hooks. Otherwise your users need to use the login flow again to be able to get a
session.</p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">path/to/my/kratos/config.yml</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># $ kratos -c path/to/my/kratos/config.yml serve</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">selfservice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">flows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">registration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">after</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">hooks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> session</span></div></div></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="data-mapping-with-jsonnet"></a>Data Mapping with Jsonnet<a aria-hidden="true" tabindex="-1" class="hash-link" href="#data-mapping-with-jsonnet" title="Direct link to heading">#</a></h2><p>The data provided by Google, GitHub, Facebook, and others will vary in payloads.
One service might include the <code>website</code> or <code>phone_number</code> while another might
not.</p><p>Therefore you need to specify how this data maps to the identity&#x27;s traits. You
can do that by writing a <a href="/kratos/docs/next/reference/jsonnet">Jsonnet Code Snippet</a> and
referencing that in your ORY Kratos config file:</p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">path/to/my/kratos/config.yml</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># $ kratos -c path/to/my/kratos/config.yml serve</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">selfservice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">providers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> github</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">mapper_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//path/to/my/kratos/github.data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">mapper.jsonnet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can also load this from a HTTP(S) source:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">mapper_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//domain.com/path/to/my/kratos/github.data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">mapper.jsonnet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Or inline it using base64 encoding:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">mapper_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> base64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//bG9jYWwgY2xhaW1zID0gc3RkLmV4dFZhcignY2xhaW1zJyk7CmlmIHN0ZC5sZW5ndGgoY2xhaW1zLnN1YikgPT0gMCB0aGVuCiAgZXJyb3IgJ2NsYWltIHN1YiBub3Qgc2V0JwplbHNlCiAgewogICAgaWRlbnRpdHk6IHsKICAgICAgdHJhaXRzOiB7CiAgICAgICAgZW1haWw6IGNsYWltcy5zdWIsCiAgICAgICAgW2lmICJ3ZWJzaXRlIiBpbiBjbGFpbXMgdGhlbiAid2Vic2l0ZSIgZWxzZSBudWxsXTogY2xhaW1zLndlYnNpdGUsCiAgICAgIH0sCiAgICB9LAogIH0=</span></div></div></div></div></div><p>ORY Kratos adds an external variable called <code>claims</code> to the data mapper. It
contains all the claims (e.g. username, email, ...) for the OpenID Connect or
OAuth2 Provider. Keep in mind that the claims will vary per provider and per
flow - depending on what permissions the user grants you (e.g. &quot;App XYZ cannot
see my private email&quot;). Your Jsonnet code must return a JSON object that looks
like:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json5 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  identity: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    traits: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      /* ... */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>For more information on Jsonnet check out our
<a href="/kratos/docs/next/reference/jsonnet">Jsonnet Documentation</a>.</p><p>To debug Jsonnet payloads, use the <code>--dev</code> flag and set <code>log.level</code> to <code>debug</code>
(e.g. <code>LOG_LEVEL=debug kratos serve --dev</code>). Logs with detailed payloads will be
emitted once you complete an OpenID Connect / OAuth2 login or registration.</p></div></div><p>The Jsonnet code snippet</p><div class="mdxCodeBlock_1XEh"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_3nn1">path/to/my/kratos/github.data-mapper.jsonnet</div><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd undefined">Copy</button><div tabindex="0" class="prism-code language-jsonnet codeBlock_3iAC codeBlockWithTitle_3QsD"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># claims contains all the data sent by the upstream.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">local claims = std.extVar(&#x27;claims&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  identity: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    traits: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      email: claims.email, // If email is not set the Jsonnet snippet will fail with an error.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      [if &quot;website&quot; in claims then &quot;website&quot; else null]: claims.website, // The website claim is optional.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>returns</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;identity&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;traits&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;email&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo@ory.sh&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;website&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://www.ory.sh&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>when the ID Token body (or the OAuth2 equivalent) returned by the OpenID Connect
provider contains:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;sub&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;some-identity-id-4hA8gk&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;email&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo@ory.sh&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;website&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://www.ory.sh&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>which is then being used for the identity&#x27;s traits.</p><p>The <code>sub</code> field, which is returned by OpenID Connect and OAuth2 servers alike is
used as the primary credential identifier for the provider. This allows ORY
Kratos to link the identity to the &quot;social sign in profile&quot; for future login
flows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This is the YAML representation of an identity</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;9f425a8d-7efc-4768-8f23-7647a74fdf13&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">credentials</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">oidc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> oidc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">identifiers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">identity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">4hA8gk</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">provider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> example</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">identifier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">identity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">4hA8gk</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">schema_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//foo.bar.com/person.schema.json </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This comes from the default identity schema url.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">traits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">email</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> foo@ory.sh </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This is extracted from `username` using</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">website</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//www.ory.sh </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This is extracted from `username` using</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="external-variable-claims"></a>External Variable <code>claims</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#external-variable-claims" title="Direct link to heading">#</a></h3><p>The <code>std.ExtVar(&#x27;claims&#x27;)</code> object has the following structure and keys
available:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> oidc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> Claims </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Issuer              </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;iss,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Subject             </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;sub,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Name                </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;name,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    GivenName           </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;given_name,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    FamilyName          </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;family_name,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    LastName            </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;last_name,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    MiddleName          </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;middle_name,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Nickname            </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;nickname,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    PreferredUsername   </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;preferred_username,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Profile             </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;profile,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Picture             </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;picture,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Website             </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;website,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Email               </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;email,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    EmailVerified       </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain">   </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;email_verified,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Gender              </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;gender,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Birthdate           </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;birthdate,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Zoneinfo            </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;zoneinfo,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Locale              </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;locale,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    PhoneNumber         </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;phone_number,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    PhoneNumberVerified </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain">   </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;phone_number_verified,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    UpdatedAt           </span><span class="token builtin" style="color:rgb(130, 170, 255)">int64</span><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;updated_at,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="identity-traits-validation-and-data-completion"></a>Identity Traits Validation and Data Completion<a aria-hidden="true" tabindex="-1" class="hash-link" href="#identity-traits-validation-and-data-completion" title="Direct link to heading">#</a></h2><p>Sometimes the data provided by OpenID Connect or OAuth2 Providers is not enough.
A common example is asking the user to consent to the terms of service. No
OpenID Connect or OAuth2 provider will be able to give you this information
because these are your terms. Another example would be a user not agreeing to
share his/her email address with you when authorizing your OAuth2 app.</p><p>If such a validation error occurs, the user will be redirected to the
Registration UI. The Registration Flow includes all the valid and invalid
fields:</p><img alt="Missing website field in OpenID Connect / OAuth2 provider claims" src="/kratos/docs/img/docs/oidc-missing.png"><p>When submitting the form again, the data provided by the user and the data
coming from the OpenID Connect / OAuth2 provider will be merged. This process
repeats itself</p><img alt="Invalid website field in OpenID Connect / OAuth2 provider claims" src="/kratos/docs/img/docs/oidc-incomplete.png"><p>until the identity&#x27;s traits are valid against the defined JSON Schema.</p><p>For more information on this flow (network flow, examples, UI, ...) head over to
the
<a href="/kratos/docs/next/self-service/flows/user-registration">OpenID Connect and OAuth2 Self-Service Method Documentation</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ory/kratos/edit/master/docs/docs/concepts/credentials/openid-connect-oidc-oauth2.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-09-06T07:45:01.000Z" class="docLastUpdatedAt_217_">9/6/2020</time> by <strong>aeneasr</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/kratos/docs/next/concepts/credentials/username-email-password"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Username / Email &amp; Password</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/kratos/docs/next/concepts/browser-redirect-flow-completion"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">HTTP Redirection Configuration Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration" class="table-of-contents__link">Configuration</a></li><li><a href="#data-mapping-with-jsonnet" class="table-of-contents__link">Data Mapping with Jsonnet</a><ul><li><a href="#external-variable-claims" class="table-of-contents__link">External Variable <code>claims</code></a></li></ul></li><li><a href="#identity-traits-validation-and-data-completion" class="table-of-contents__link">Identity Traits Validation and Data Completion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Company</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.ory.sh/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.ory.sh/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://www.ory.sh/tos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 ORY GmbH</div></div></div><div id="codefund"></div><script src="https://codefund.io/properties/140/funder.js" async=""></script><script>document.querySelectorAll(".tabs .tabs-nav .nav-item a").forEach((function(t){t.addEventListener("click",(function(e){return e.preventDefault(),t.closest(".tabs-nav").querySelectorAll(".nav-item a").forEach((function(t){t.classList.remove("active")})),t.closest(".tabs").querySelectorAll(".tab-content .tab-pane").forEach((function(t){t.classList.remove("active")})),t.classList.add("active"),document.getElementById(t.href.split("#")[1]).classList.add("active"),!1}))}))</script></footer></div>
<script src="/kratos/docs/styles.47fe7342.js"></script>
<script src="/kratos/docs/runtime~main.25132285.js"></script>
<script src="/kratos/docs/main.ad3de72d.js"></script>
<script src="/kratos/docs/2.3f0cafd9.js"></script>
<script src="/kratos/docs/3.9748f2ba.js"></script>
<script src="/kratos/docs/1be78505.d928f7bc.js"></script>
<script src="/kratos/docs/eb6fb697.9e49424f.js"></script>
<script src="/kratos/docs/255.5a2f44ed.js"></script>
<script src="/kratos/docs/254.7bfb09c2.js"></script>
<script src="/kratos/docs/86d007ba.9e11e37f.js"></script>
<script src="/kratos/docs/17896441.b979b995.js"></script>
<script src="/kratos/docs/56ff8f6b.be9122ea.js"></script>
</body>
</html>